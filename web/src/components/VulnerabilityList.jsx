export default function VulnerabilityList({ items = [], loading = false }) {
  const sorted = Array.isArray(items)
    ? [...items].sort((a, b) => {
        const ta = a?.created_at ? new Date(a.created_at).getTime() : 0
        const tb = b?.created_at ? new Date(b.created_at).getTime() : 0
        return tb - ta
      })
    : []

  return (
    <div className="card">
      <div className="p-4 border-b border-slate-700 flex items-center justify-between">
        <div>
          <h3 className="font-semibold">Vulnerabilities</h3>
          <p className="text-sm text-slate-400">Potensi SQL injection terdeteksi dari parameter dan form</p>
        </div>
        <div className={`badge ${sorted.length > 0 ? 'bg-rose-700/60 text-rose-200' : 'bg-emerald-700/60 text-emerald-200'}`}>
          {sorted.length > 0 ? `${sorted.length} found` : 'No findings'}
        </div>
      </div>
      {loading && (
        <div className="p-4 text-sm text-slate-300 flex items-center gap-2">
          <svg aria-hidden="true" viewBox="0 0 24 24" className="h-4 w-4 animate-spin shrink-0">
            <circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" opacity="0.25" />
            <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" strokeWidth="4" fill="none" opacity="0.85" />
          </svg>
          <span>Mengambil data vulnerability…</span>
        </div>
      )}
      <div className="border-t border-slate-700 bg-slate-950">
        <div className="h-[300px] overflow-y-auto font-mono text-xs leading-6 p-4">
          {sorted.map((v, i) => (
            <div key={v.id ?? i} className="py-1">
              <span className="text-slate-500">{String(i + 1).padStart(3, ' ')}</span>
              <span className="mx-2 text-rose-500">⚠︎</span>
              <a className="text-rose-300 hover:underline break-words" href={v.url} target="_blank" rel="noreferrer">{v.url}</a>
              <span className="ml-2 text-slate-600">[{v.method || 'GET'}:{v.field || '-'}]</span>
              {v.payload && <span className="ml-2 text-slate-500">payload="{v.payload}"</span>}
              {v.evidence && <span className="ml-2 text-slate-400">{v.evidence}</span>}
            </div>
          ))}
          {sorted.length === 0 && (
            <div className="text-slate-400">Tidak ada temuan vulnerability untuk job ini.</div>
          )}
        </div>
      </div>
    </div>
  )
}